%h4 Reports for week
= raw show_weeks if current_user.admin

%h2 Your tasks for today

#calendar
%table{:border => 1}
  %tr
    - if current_user.admin
      %th
        = sortable "users.username", "Users", params[:date]
    %th
      = sortable "projects.name",  "Projects", params[:date]
    %th
      = sortable "task_name",  "Task name", params[:date]
    %th
      = sortable "description", "Description", params[:date]
    %th
      = sortable "start_time", "Start time", params[:date]
    %th
      = sortable  "end_time", "Finish time", params[:date]
    %th
      = sortable "external_link", "External_link", params[:date]
  - @tasks.each do |task|
    %tr
      - if current_user.admin
        %td
          = task.user.username
      %td
        = task.project.name 
      %td
        =task.task_name
      %td
        = truncate(task.description, :length => 60)
      %td
        = task.start_time.strftime("%H:%M")
      %td
        = task.end_time.strftime("%H:%M") 
      %td 
        = raw(auto_link(task.external_link))
      - if @current_date == Date.today or current_user.admin
        %td
          = link_to 'Edit', edit_task_path(task), :rel=>"#overlay"
          %br
          = link_to 'Destroy', task, :confirm => 'Are you sure?', :method => :delete

= link_to 'New Task', new_task_path, :rel=>"#overlay"
.apple_overlay#overlay
  .contentWrap

%p
  = will_paginate @tasks
  - unless @tasks.empty?
    Number items on page:
    = select_tag "per_page", options_for_select([[3,3], [5,5], [10,10], ["all", 100000]], session["#{current_user.id}_per_page"][:per_page]), :onchange => "per_page(this.value)"

:javascript
  $(document).ready(function() {
    $('#calendar').datepicker({
      firstDay: 1, 
      defaultDate: new Date('#{params[:date]}'),
      onSelect: function(dataText){
        window.location.href = "/?date=" + dataText;
      }
    });
  });
